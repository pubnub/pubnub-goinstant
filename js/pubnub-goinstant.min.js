var hasValue=function(n){return!("undefined"==typeof n||null===n)},isFunction=function(n){return!("undefined"==typeof n||null===n||"function"!=typeof n)},isObject=function(n){return!("object"!=typeof n||null===n)};!function(n){if("object"==typeof exports)module.exports=n();else if("function"==typeof define&&define.amd)define(n);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.stampit=n()}}(function(){var n,t,e;return function o(n,t,e){function r(u,c){if(!t[u]){if(!n[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=t[u]={exports:{}};n[u][0].call(a.exports,function(t){var e=n[u][1][t];return r(e?e:t)},a,a.exports,o,n,t,e)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<e.length;u++)r(e[u]);return r}({1:[function(n,t,e){function o(n,t){this[t]=n}var r=n("mout/object/forIn");t.exports=function i(n,t){for(var e=0,i=arguments.length,u;++e<i;)u=arguments[e],null!=u&&r(u,o,n);return n}},{"mout/object/forIn":14}],2:[function(n,t,e){function o(n,t,e){if(null!=n)for(var o=-1,r=n.length;++o<r&&t.call(e,n[o],o,n)!==!1;);}t.exports=o},{}],3:[function(n,t,e){function o(n,t,e){t=i(t,e);var o=[];if(null==n)return o;for(var r=-1,u=n.length;++r<u;)o[r]=t(n[r],r,n);return o}var r=n("./forEach"),i=n("../function/makeIterator_");t.exports=o},{"../function/makeIterator_":4,"./forEach":2}],4:[function(n,t,e){function o(n,t){switch(typeof n){case"object":return null!=n?function(t,e,o){return i(t,n)}:n;case"string":case"number":return r(n);case"function":return"undefined"==typeof t?n:function(e,o,r){return n.call(t,e,o,r)};default:return n}}var r=n("./prop"),i=n("../object/deepMatches");t.exports=o},{"../object/deepMatches":13,"./prop":5}],5:[function(n,t,e){function o(n){return function(t){return t[n]}}t.exports=o},{}],6:[function(n,t,e){function o(n){switch(s(n)){case"Object":return r(n);case"Array":return c(n);case"RegExp":return i(n);case"Date":return u(n);default:return n}}function r(n){return a(n)?f({},n):n}function i(n){var t="";return t+=n.multiline?"m":"",t+=n.global?"g":"",t+=n.ignorecase?"i":"",new RegExp(n.source,t)}function u(n){return new Date(+n)}function c(n){return n.slice()}var s=n("./kindOf"),a=n("./isPlainObject"),f=n("../object/mixIn");t.exports=o},{"../object/mixIn":18,"./isPlainObject":11,"./kindOf":12}],7:[function(n,t,e){function o(n,t){switch(s(n)){case"Object":return r(n,t);case"Array":return i(n,t);default:return u(n)}}function r(n,t){if(a(n)){var e={};return c(n,function(n,e){this[e]=o(n,t)},e),e}return t?t(n):n}function i(n,t){for(var e=[],r=-1,i=n.length,u;++r<i;)e[r]=o(n[r],t);return e}var u=n("./clone"),c=n("../object/forOwn"),s=n("./kindOf"),a=n("./isPlainObject");t.exports=o},{"../object/forOwn":15,"./clone":6,"./isPlainObject":11,"./kindOf":12}],8:[function(n,t,e){var o=n("./isKind"),r=Array.isArray||function(n){return o(n,"Array")};t.exports=r},{"./isKind":9}],9:[function(n,t,e){function o(n,t){return r(n)===t}var r=n("./kindOf");t.exports=o},{"./kindOf":12}],10:[function(n,t,e){function o(n){return r(n,"Object")}var r=n("./isKind");t.exports=o},{"./isKind":9}],11:[function(n,t,e){function o(n){return!!n&&"object"==typeof n&&n.constructor===Object}t.exports=o},{}],12:[function(n,t,e){function o(n){return null===n?"Null":n===u?"Undefined":r.exec(i.call(n))[1]}var r=/^\[object (.*)\]$/,i=Object.prototype.toString,u;t.exports=o},{}],13:[function(n,t,e){function o(n,t){for(var e=-1,o=n.length;++e<o;)if(u(n[e],t))return!0;return!1}function r(n,t){for(var e=-1,r=t.length;++e<r;)if(!o(n,t[e]))return!1;return!0}function i(n,t){var e=!0;return c(t,function(t,o){return u(n[o],t)?void 0:e=!1}),e}function u(n,t){return n&&"object"==typeof n?s(n)&&s(t)?r(n,t):i(n,t):n===t}var c=n("./forOwn"),s=n("../lang/isArray");t.exports=u},{"../lang/isArray":8,"./forOwn":15}],14:[function(n,t,e){function o(){c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=!0;for(var n in{toString:null})u=!1}function r(n,t,e){var r,s=0;null==u&&o();for(r in n)if(i(t,n,r,e)===!1)break;if(u)for(;(r=c[s++])&&(n[r]===Object.prototype[r]||i(t,n,r,e)!==!1););}function i(n,t,e,o){return n.call(o,t[e],e,t)}var u,c;t.exports=r},{}],15:[function(n,t,e){function o(n,t,e){i(n,function(o,i){return r(n,i)?t.call(e,n[i],i,n):void 0})}var r=n("./hasOwn"),i=n("./forIn");t.exports=o},{"./forIn":14,"./hasOwn":16}],16:[function(n,t,e){function o(n,t){return Object.prototype.hasOwnProperty.call(n,t)}t.exports=o},{}],17:[function(n,t,e){function o(){var n=1,t,e,c,s;for(s=i(arguments[0]);c=arguments[n++];)for(t in c)r(c,t)&&(e=c[t],s[t]=u(e)&&u(s[t])?o(s[t],e):i(e));return s}var r=n("./hasOwn"),i=n("../lang/deepClone"),u=n("../lang/isObject");t.exports=o},{"../lang/deepClone":7,"../lang/isObject":10,"./hasOwn":16}],18:[function(n,t,e){function o(n,t){for(var e=0,o=arguments.length,u;++e<o;)u=arguments[e],null!=u&&i(u,r,n);return n}function r(n,t){this[t]=n}var i=n("./forOwn");t.exports=o},{"./forOwn":15}],19:[function(n,t,e){"use strict";var o=n("mout/array/forEach"),r=n("mout/object/mixIn"),i=n("mout/object/merge"),u=n("mout/array/map"),c=n("mout/object/forOwn"),s=n("./mixinchain.js"),a=[].slice,f=function(n){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=n,new t};Array.isArray||(Array.isArray=function(n){return"[object Array]"===Object.prototype.toString.call(n)});var p=function y(n){var t=[],e=[].slice.call(arguments);return"function"==typeof n?t=u(e,function(n){return"function"==typeof n?n:void 0}):"object"==typeof n?o(e,function(n){c(n,function(n){t.push(n)})}):Array.isArray(n)&&o(n,function(n){t.push(n)}),t},l=function m(n,t,e){var u={methods:n||{},state:t,enclose:p(e)},c=function l(n){var t=i({},u.state),e=r(f(u.methods||{}),t,n),c=u.enclose,s=a.call(arguments,1);return o(c,function(n){"function"==typeof n&&(e=n.apply(e,s)||e)}),e};return r(c,{create:c,fixed:u,methods:function d(){var n=u.methods||{},t=[n].concat([].slice.call(arguments));return u.methods=s.apply(this,t),this},state:function h(){var n=u.state||{},t=[n].concat([].slice.call(arguments));return u.state=r.apply(this,t),this},enclose:function y(){return u.enclose=u.enclose.concat(p.apply(null,arguments)),this}})},d=function v(){var n=[].slice.call(arguments),t=l();return o(n,function(n){n&&(n.fixed.methods&&(t.fixed.methods=s({},t.fixed.methods,n.fixed.methods)),n.fixed.state&&(t.fixed.state=r({},t.fixed.state,n.fixed.state)),n.fixed.enclose&&(t.fixed.enclose=t.fixed.enclose.concat(n.fixed.enclose)))}),l(t.fixed.methods,t.fixed.state,t.fixed.enclose)},h=function g(n){return l().methods(n.prototype).enclose(n)};t.exports=r(l,{compose:d,extend:r,mixIn:r,convertConstructor:h})},{"./mixinchain.js":1,"mout/array/forEach":2,"mout/array/map":3,"mout/object/forOwn":15,"mout/object/merge":17,"mout/object/mixIn":18}]},{},[19])(19)}),function(n){if("function"==typeof bootstrap)bootstrap("promise",n);else if("object"==typeof exports)module.exports=n();else if("function"==typeof define&&define.amd)define(n);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=n}else Q=n()}(function(){"use strict";function n(n){return function(){return Y.apply(n,arguments)}}function t(n){return n===Object(n)}function e(n){return"[object StopIteration]"===tt(n)||n instanceof et}function o(n,t){if(U&&t.stack&&"object"==typeof n&&null!==n&&n.stack&&-1===n.stack.indexOf(ot)){for(var e=[],o=t;o;o=o.source)o.stack&&e.unshift(o.stack);e.unshift(n.stack);var i=e.join("\n"+ot+"\n");n.stack=r(i)}}function r(n){for(var t=n.split("\n"),e=[],o=0;o<t.length;++o){var r=t[o];c(r)||i(r)||!r||e.push(r)}return e.join("\n")}function i(n){return-1!==n.indexOf("(module.js:")||-1!==n.indexOf("(node.js:")}function u(n){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n);if(t)return[t[1],Number(t[2])];var e=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n);if(e)return[e[1],Number(e[2])];var o=/.*@(.+):(\d+)$/.exec(n);return o?[o[1],Number(o[2])]:void 0}function c(n){var t=u(n);if(!t)return!1;var e=t[0],o=t[1];return e===M&&o>=K&&ct>=o}function s(){if(U)try{throw new Error}catch(n){var t=n.stack.split("\n"),e=t[0].indexOf("@")>0?t[1]:t[2],o=u(e);if(!o)return;return M=o[0],o[1]}}function a(n,t,e){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+e+" instead.",new Error("").stack),n.apply(n,arguments)}}function f(n){return v(n)?n:g(n)?A(n):N(n)}function p(){function n(n){o=n,i.source=n,H(t,function(t,e){Q(function(){n.promiseDispatch.apply(n,e)})},void 0),t=void 0,e=void 0}var t=[],e=[],o,r=X(p.prototype),i=X(h.prototype);if(i.promiseDispatch=function(n,r,i){var u=z(arguments);t?(t.push(u),"when"===r&&i[1]&&e.push(i[1])):Q(function(){o.promiseDispatch.apply(o,u)})},i.valueOf=function(){if(t)return i;var n=m(o);return v(n)&&(o=n),n},i.inspect=function(){return o?o.inspect():{state:"pending"}},f.longStackSupport&&U)try{throw new Error}catch(u){i.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return r.promise=i,r.resolve=function(t){o||n(f(t))},r.fulfill=function(t){o||n(N(t))},r.reject=function(t){o||n(R(t))},r.notify=function(n){o||H(e,function(t,e){Q(function(){e(n)})},void 0)},r}function l(n){if("function"!=typeof n)throw new TypeError("resolver must be a function.");var t=p();try{n(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function d(n){return l(function(t,e){for(var o=0,r=n.length;r>o;o++)f(n[o]).then(t,e)})}function h(n,t,e){void 0===t&&(t=function(n){return R(new Error("Promise does not support operation: "+n))}),void 0===e&&(e=function(){return{state:"unknown"}});var o=X(h.prototype);if(o.promiseDispatch=function(e,r,i){var u;try{u=n[r]?n[r].apply(o,i):t.call(o,r,i)}catch(c){u=R(c)}e&&e(u)},o.inspect=e,e){var r=e();"rejected"===r.state&&(o.exception=r.reason),o.valueOf=function(){var n=e();return"pending"===n.state||"rejected"===n.state?o:n.value}}return o}function y(n,t,e,o){return f(n).then(t,e,o)}function m(n){if(v(n)){var t=n.inspect();if("fulfilled"===t.state)return t.value}return n}function v(n){return t(n)&&"function"==typeof n.promiseDispatch&&"function"==typeof n.inspect}function g(n){return t(n)&&"function"==typeof n.then}function b(n){return v(n)&&"pending"===n.inspect().state}function j(n){return!v(n)||"fulfilled"===n.inspect().state}function O(n){return v(n)&&"rejected"===n.inspect().state}function w(){rt.length=0,it.length=0,ut||(ut=!0)}function x(n,t){ut&&(it.push(n),rt.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t))}function k(n){if(ut){var t=J(it,n);-1!==t&&(it.splice(t,1),rt.splice(t,1))}}function R(n){var t=h({when:function(t){return t&&k(this),t?t(n):this}},function e(){return this},function o(){return{state:"rejected",reason:n}});return x(t,n),t}function N(n){return h({when:function(){return n},get:function(t){return n[t]},set:function(t,e){n[t]=e},"delete":function(t){delete n[t]},post:function(t,e){return null===t||void 0===t?n.apply(void 0,e):n[t].apply(n,e)},apply:function(t,e){return n.apply(t,e)},keys:function(){return nt(n)}},void 0,function t(){return{state:"fulfilled",value:n}})}function A(n){var t=p();return Q(function(){try{n.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise}function E(n){return h({isDef:function(){}},function t(e,o){return G(n,e,o)},function(){return f(n).inspect()})}function I(n,t,e){return f(n).spread(t,e)}function C(n){return function(){function t(n,t){var u;if("undefined"==typeof StopIteration){try{u=o[n](t)}catch(c){return R(c)}return u.done?u.value:y(u.value,r,i)}try{u=o[n](t)}catch(c){return e(c)?c.value:R(c)}return y(u,r,i)}var o=n.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function L(n){f.done(f.async(n)())}function P(n){throw new et(n)}function _(n){return function(){return I([this,T(arguments)],function(t,e){return n.apply(t,e)})}}function G(n,t,e){return f(n).dispatch(t,e)}function T(n){return y(n,function(n){var t=0,e=p();return H(n,function(o,r,i){var u;v(r)&&"fulfilled"===(u=r.inspect()).state?n[i]=u.value:(++t,y(r,function(o){n[i]=o,0===--t&&e.resolve(n)},e.reject,function(n){e.notify({index:i,value:n})}))},void 0),0===t&&e.resolve(n),e.promise})}function D(n){return y(n,function(n){return n=W(n,f),y(T(W(n,function(n){return y(n,q,q)})),function(){return n})})}function B(n){return f(n).allSettled()}function S(n,t){return f(n).then(void 0,void 0,t)}function V(n,t){return f(n).nodeify(t)}var U=!1;try{throw new Error}catch(F){U=!!F.stack}var K=s(),M,q=function(){},Q=function(){function n(){for(;t.next;){t=t.next;var e=t.task;t.task=void 0;var r=t.domain;r&&(t.domain=void 0,r.enter());try{e()}catch(u){if(i)throw r&&r.exit(),setTimeout(n,0),r&&r.enter(),u;setTimeout(function(){throw u},0)}r&&r.exit()}o=!1}var t={task:void 0,next:null},e=t,o=!1,r=void 0,i=!1;if(Q=function(n){e=e.next={task:n,domain:i&&process.domain,next:null},o||(o=!0,r())},"undefined"!=typeof process&&process.nextTick)i=!0,r=function(){process.nextTick(n)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=function(){r=c,u.port1.onmessage=n,n()};var c=function(){u.port2.postMessage(0)};r=function(){setTimeout(n,0),c()}}else r=function(){setTimeout(n,0)};return Q}(),Y=Function.call,z=n(Array.prototype.slice),H=n(Array.prototype.reduce||function(n,t){var e=0,o=this.length;if(1===arguments.length)for(;;){if(e in this){t=this[e++];break}if(++e>=o)throw new TypeError}for(;o>e;e++)e in this&&(t=n(t,this[e],e));return t}),J=n(Array.prototype.indexOf||function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}),W=n(Array.prototype.map||function(n,t){var e=this,o=[];return H(e,function(r,i,u){o.push(n.call(t,i,u,e))},void 0),o}),X=Object.create||function(n){function t(){}return t.prototype=n,new t},Z=n(Object.prototype.hasOwnProperty),nt=Object.keys||function(n){var t=[];for(var e in n)Z(n,e)&&t.push(e);return t},tt=n(Object.prototype.toString),et;et="undefined"!=typeof ReturnValue?ReturnValue:function(n){this.value=n};var ot="From previous event:";f.resolve=f,f.nextTick=Q,f.longStackSupport=!1,f.defer=p,p.prototype.makeNodeResolver=function(){var n=this;return function(t,e){t?n.reject(t):n.resolve(arguments.length>2?z(arguments,1):e)}},f.Promise=l,f.promise=l,l.race=d,l.all=T,l.reject=R,l.resolve=f,f.passByCopy=function(n){return n},h.prototype.passByCopy=function(){return this},f.join=function(n,t){return f(n).join(t)},h.prototype.join=function(n){return f([this,n]).spread(function(n,t){if(n===t)return n;throw new Error("Can't join: not the same: "+n+" "+t)})},f.race=d,h.prototype.race=function(){return this.then(f.race)},f.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(n,t,e){function r(t){try{return"function"==typeof n?n(t):t}catch(e){return R(e)}}function i(n){if("function"==typeof t){o(n,c);try{return t(n)}catch(e){return R(e)}}return R(n)}function u(n){return"function"==typeof e?e(n):n}var c=this,s=p(),a=!1;return Q(function(){c.promiseDispatch(function(n){a||(a=!0,s.resolve(r(n)))},"when",[function(n){a||(a=!0,s.resolve(i(n)))}])}),c.promiseDispatch(void 0,"when",[void 0,function(n){var t,e=!1;try{t=u(n)}catch(o){if(e=!0,!f.onerror)throw o;f.onerror(o)}e||s.notify(t)}]),s.promise},f.when=y,h.prototype.thenResolve=function(n){return this.then(function(){return n})},f.thenResolve=function(n,t){return f(n).thenResolve(t)},h.prototype.thenReject=function(n){return this.then(function(){throw n})},f.thenReject=function(n,t){return f(n).thenReject(t)},f.nearer=m,f.isPromise=v,f.isPromiseAlike=g,f.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=j,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=O,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],it=[],ut=!0;f.resetUnhandledRejections=w,f.getUnhandledReasons=function(){return rt.slice()},f.stopUnhandledRejectionTracking=function(){w(),ut=!1},w(),f.reject=R,f.fulfill=N,f.master=E,f.spread=I,h.prototype.spread=function(n,t){return this.all().then(function(t){return n.apply(void 0,t)},t)},f.async=C,f.spawn=L,f["return"]=P,f.promised=_,f.dispatch=G,h.prototype.dispatch=function(n,t){var e=this,o=p();return Q(function(){e.promiseDispatch(o.resolve,n,t)}),o.promise},f.get=function(n,t){return f(n).dispatch("get",[t])},h.prototype.get=function(n){return this.dispatch("get",[n])},f.set=function(n,t,e){return f(n).dispatch("set",[t,e])},h.prototype.set=function(n,t){return this.dispatch("set",[n,t])},f.del=f["delete"]=function(n,t){return f(n).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(n){return this.dispatch("delete",[n])},f.mapply=f.post=function(n,t,e){return f(n).dispatch("post",[t,e])},h.prototype.mapply=h.prototype.post=function(n,t){return this.dispatch("post",[n,t])},f.send=f.mcall=f.invoke=function(n,t){return f(n).dispatch("post",[t,z(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(n){return this.dispatch("post",[n,z(arguments,1)])},f.fapply=function(n,t){return f(n).dispatch("apply",[void 0,t])},h.prototype.fapply=function(n){return this.dispatch("apply",[void 0,n])},f["try"]=f.fcall=function(n){return f(n).dispatch("apply",[void 0,z(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,z(arguments)])},f.fbind=function(n){var t=f(n),e=z(arguments,1);return function o(){return t.dispatch("apply",[this,e.concat(z(arguments))])}},h.prototype.fbind=function(){var n=this,t=z(arguments);return function e(){return n.dispatch("apply",[this,t.concat(z(arguments))])}},f.keys=function(n){return f(n).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},f.all=T,h.prototype.all=function(){return T(this)},f.allResolved=a(D,"allResolved","allSettled"),h.prototype.allResolved=function(){return D(this)},f.allSettled=B,h.prototype.allSettled=function(){return this.then(function(n){return T(W(n,function(n){function t(){return n.inspect()}return n=f(n),n.then(t,t)}))})},f.fail=f["catch"]=function(n,t){return f(n).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(n){return this.then(void 0,n)},f.progress=S,h.prototype.progress=function(n){return this.then(void 0,void 0,n)},f.fin=f["finally"]=function(n,t){return f(n)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(n){return n=f(n),this.then(function(t){return n.fcall().then(function(){return t})},function(t){return n.fcall().then(function(){throw t})})},f.done=function(n,t,e,o){return f(n).done(t,e,o)},h.prototype.done=function(n,t,e){var r=function(n){Q(function(){if(o(n,i),!f.onerror)throw n;f.onerror(n)})},i=n||t||e?this.then(n,t,e):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},f.timeout=function(n,t,e){return f(n).timeout(t,e)},h.prototype.timeout=function(n,t){var e=p(),o=setTimeout(function(){e.reject(new Error(t||"Timed out after "+n+" ms"))},n);return this.then(function(n){clearTimeout(o),e.resolve(n)},function(n){clearTimeout(o),e.reject(n)},e.notify),e.promise},f.delay=function(n,t){return void 0===t&&(t=n,n=void 0),f(n).delay(t)},h.prototype.delay=function(n){return this.then(function(t){var e=p();return setTimeout(function(){e.resolve(t)},n),e.promise})},f.nfapply=function(n,t){return f(n).nfapply(t)},h.prototype.nfapply=function(n){var t=p(),e=z(n);return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},f.nfcall=function(n){var t=z(arguments,1);return f(n).nfapply(t)},h.prototype.nfcall=function(){var n=z(arguments),t=p();return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},f.nfbind=f.denodeify=function(n){var t=z(arguments,1);return function(){var e=t.concat(z(arguments)),o=p();return e.push(o.makeNodeResolver()),f(n).fapply(e).fail(o.reject),o.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var n=z(arguments);return n.unshift(this),f.denodeify.apply(void 0,n)},f.nbind=function(n,t){var e=z(arguments,2);return function(){function o(){return n.apply(t,arguments)}var r=e.concat(z(arguments)),i=p();return r.push(i.makeNodeResolver()),f(o).fapply(r).fail(i.reject),i.promise}},h.prototype.nbind=function(){var n=z(arguments,0);return n.unshift(this),f.nbind.apply(void 0,n)},f.nmapply=f.npost=function(n,t,e){return f(n).npost(t,e)},h.prototype.nmapply=h.prototype.npost=function(n,t){var e=z(t||[]),o=p();return e.push(o.makeNodeResolver()),this.dispatch("post",[n,e]).fail(o.reject),o.promise},f.nsend=f.nmcall=f.ninvoke=function(n,t){var e=z(arguments,2),o=p();return e.push(o.makeNodeResolver()),f(n).dispatch("post",[t,e]).fail(o.reject),o.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(n){var t=z(arguments,1),e=p();return t.push(e.makeNodeResolver()),this.dispatch("post",[n,t]).fail(e.reject),e.promise},f.nodeify=V,h.prototype.nodeify=function(n){return n?void this.then(function(t){Q(function(){n(null,t)})},function(t){Q(function(){n(t)})}):this};var ct=s();return f}),window.goinstant2={},window.goinstant2.BaseClasses={},goinstant2.App=function n(){function n(){var n=!1;return{log:function(t,e,o){if(n){var r="";r+=hasValue(e)?e+": ":"",r+=hasValue(o)?o+"() - ":"",isObject(t)?console.log(r,"%O",t):(r+=t,console.log(r))}},info:function(t,e,o){if(n){var r="";r+=hasValue(e)?e+": ":"",r+=hasValue(o)?o+"() - ":"",isObject(t)?console.info(r,"%O",t):(r+=t,console.info(r))}},logging:function(t){n=t}}}var t;return{getInstance:function(){return t||(t=n()),t}}}(),window.goinstant2.App=goinstant2.App.getInstance(),goinstant2.App.logging(!0),LOG=goinstant2.App.log,INFO=goinstant2.App.info,goinstant2.connect=function(n,t,e){return new goinstant2.Connection(n).connect(t,e)},goinstant2.Connection=function(n){return(new goinstant2.BaseClasses.connection).url(n)},goinstant2.BaseClasses.connection=stampit().enclose(function(){function n(){var n=r.slice(15).split("/");s.keys={publish_key:n[0],subscribe_key:n[1],secret_key:n[2]},o=PUBNUB.init(s.keys),s.pubnub=o}function t(n){hasValue(e)||(e={displayName:"Guest"});var t=new goinstant2.BaseClasses.room;return t.name(n).context(s).user(e),t.join(),s.rooms.push(t),t}var e=null,o=null,r,i,u,c,s={connection:this,user:null,rooms:[],pubnub:null,keys:{}};return stampit.mixIn(this,{url:function(t){return t?(r=t,n(),this):r},context:function(){return s},connect:function(n,o){var r=!1,i=!1,u=!1,c,s,a=[];if(hasValue(n)&&hasValue(o)?(r=!0,i=!0,c=n,s=o):isObject(n)?(r=!0,c=n,u=!0):isFunction(n)?(i=!0,s=n):u=!0,r&&(_.has(c,"user")&&(e=c.user),_.has(c,"room")?a.push(c.room):_.has(c,"rooms")&&_.forEach(c.rooms,function(n){a.push(n)}),_.has(c,"visible")&&c.visible&&console.warn("#goinstant2.connect option 'visible: false' not available in this SDK")),0==a.length&&a.push("lobby"),u){LOG("using promise","Connection","connect");var f=Q.defer(),p={connection:this,rooms:[]};return INFO("Add Chained Promise Resolves to Room Connections"),_.forEach(a,function(n){var e=t(n);p.rooms.push(e)}),p.connection=this,f.resolve(p),f.promise}LOG("using callback","Connection","connect");var l=null,d=[l];return d.push(this),INFO("Connection Errors are only generated from Room objects","Connection","connect"),_.forEach(a,function(n){var e=t(n);d.push(e)}),s.apply(this,d),this},room:function(n){return t(n)},rooms:function(){}})}),goinstant2.BaseClasses.room=stampit().enclose(function(){function n(n){LOG("PUBNUB subscribe to "+i,"Room","_presence["+r+"]"),"join"===n.action?"function"==typeof s.join&&s.join({user:n.uuid}):("leave"===n.action||"timeout"===n.action)&&"function"==typeof s.leave&&s.leave({user:n.uuid})}function t(n,t,e){}var e,o,r,i,u,c,s={join:null,leave:null,joinLocal:null,leaveLocal:null},a=!1;return stampit.mixIn(this,{name:function(n){return n?(r=n,i="ROOM:::"+n,this):r},context:function(n){return n?(e=n,o=e.pubnub,c=new goinstant2.Key(e,r,".users"),this):context},joined:function(){return a},join:function(e,u,c){LOG("PUBNUB subscribe to "+r,"Room","join");var s=this,f=!1,p=!1,l=!1,d=!1,h,y,m;hasValue(e)&&hasValue(u)&&hasValue(c)?(f=!0,p=!0,l=!0,h=e,y=u,m=c):hasValue(e)&&hasValue(u)?(f=!0,l=!0,h=e,m=u):hasValue(e)?(l=!0,m=e):d=!0;var v={channel:i,presence:function(t){n(t)},message:function(n,e,o){t(n,e,o)},connect:function(){LOG("PUBNUB connected to "+i,"Room","join._pubnub.subscribe.connect"),a=!0},disconnect:function(){LOG("PUBNUB disconnected "+i,"Room","join._pubnub.subscribe.disconnect"),a=!1,console.log(_state)}};if(f&&hasValue(h.displayName)||(h={displayName:"Guest "+Math.floor(1e5*Math.random()+1e4).toString()}),v.state=h,d){LOG("using promise","Room","join");var g=Q.defer();return v.connect=function(){a=!0;var n={err:null,room:s,user:h};g.resolve(n)},v.error=function(n){g.reject(new Error(n))},o.subscribe(v),g.promise}return LOG("using callback","Room","join"),this},leave:function(n){return LOG("PUBNUB unsubscribe to "+r,"Room","leave"),o.unsubscribe({channel:i}),isFunction(n)&&n({err:null}),this},self:function(){return LOG("","Room","self"),LOG("return data sync info (KEY) for user with userID","Room","TODO-user"),c},user:function(n){return LOG(n,"Room","user"),LOG("return data sync info (KEY) for user with userID","Room","TODO-user"),null},users:function(){return LOG("users collection","Room","users"),LOG("return data sync info (KEY) for user list","Room","TODO-users"),null},key:function(n){return LOG(n,"Room","key"),LOG("implement Key class","Room","TODO-key"),null},on:function(n,t,e){LOG(n,"Room","on");var o=!1,r=!1,i=null,u=null;"undefined"!=typeof t&&"undefined"!=typeof e?(o=!0,r=!0,i=t,u=e):"object"==typeof t?(o=!0,i=t):"function"==typeof t&&(r=!0,u=t),"join"===n?s.join=u:"leave"===n&&(s.leave=u)},off:function(n,t,e){_self=this,LOG(n,"Room","off");var o=!1,r=!1,i=!1,u=null,c=null;("undefined"!=typeof n||null!=n)&&(o=!0),"undefined"!=typeof t&&"undefined"!=typeof e?(r=!0,i=!0,u=t,c=e):"object"==typeof t?(r=!0,u=t):"function"==typeof t&&(i=!0,c=t),o||r||i||(s.join=null,s.leave=null)}})}),goinstant2.Channel=function t(n,e){function o(n,t,e){isFunction(a.message)&&message(n)}function r(n,t){var e={err:null},o=function r(n){null!==n&&"undefined"!=typeof n&&(e.err=n)};u.publish({channel:c,message:n,error:o}),isFunction(t)&&t(e)}var i=n,u=i.pubnub,c=e,s={joined:!1},a={message:null};return function f(){var n={channel:c,message:function(n,t,e){o(n,t,e)},connect:function(){this._state.joined=!0},disconnect:function(){this._state.joined=!1}};"undefined"!==_user.displayName&&(n.state={id:_user.id,displayName:_user.displayName}),u.subscribe(n)}(),{message:function(n,t){r(n,t)},on:function(n,t){hasValue(n)&&"message"===n&&isFunction(t)&&(a.message=t)}}},goinstant2.Key=function e(n,t,o){function r(){console.log("TODO: Key._getValue("+key+")")}var i=n,u=i.pubnub,c=t,s=o,a=c+"/"+o,f=null;return{get:function(n){var t={err:null,value:f,context:null};return t},key:function(n){return new goinstant2.Key(c,s+"/"+n,u)},parent:function(){console.log("TODO: return parent key")},then:function(n){n(i)}}};
//# sourceMappingURL=./pubnub-goinstant.min.map