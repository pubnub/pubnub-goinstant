var hasValue=function(e){return!("undefined"==typeof e||null===e)},isFunction=function(e){return!("undefined"==typeof e||null===e||"function"!=typeof e)},isObject=function(e){return!("object"!=typeof e||null===e)};!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.stampit=e()}}(function(){var e,n,t;return function r(e,n,t){function o(u,a){if(!n[u]){if(!e[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var s=n[u]={exports:{}};e[u][0].call(s.exports,function(n){var t=e[u][1][n];return o(t?t:n)},s,s.exports,r,e,n,t)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<t.length;u++)o(t[u]);return o}({1:[function(e,n,t){function r(e,n){this[n]=e}var o=e("mout/object/forIn");n.exports=function i(e,n){for(var t=0,i=arguments.length,u;++t<i;)u=arguments[t],null!=u&&o(u,r,e);return e}},{"mout/object/forIn":14}],2:[function(e,n,t){function r(e,n,t){if(null!=e)for(var r=-1,o=e.length;++r<o&&n.call(t,e[r],r,e)!==!1;);}n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n=i(n,t);var r=[];if(null==e)return r;for(var o=-1,u=e.length;++o<u;)r[o]=n(e[o],o,e);return r}var o=e("./forEach"),i=e("../function/makeIterator_");n.exports=r},{"../function/makeIterator_":4,"./forEach":2}],4:[function(e,n,t){function r(e,n){switch(typeof e){case"object":return null!=e?function(n,t,r){return i(n,e)}:e;case"string":case"number":return o(e);case"function":return"undefined"==typeof n?e:function(t,r,o){return e.call(n,t,r,o)};default:return e}}var o=e("./prop"),i=e("../object/deepMatches");n.exports=r},{"../object/deepMatches":13,"./prop":5}],5:[function(e,n,t){function r(e){return function(n){return n[e]}}n.exports=r},{}],6:[function(e,n,t){function r(e){switch(c(e)){case"Object":return o(e);case"Array":return a(e);case"RegExp":return i(e);case"Date":return u(e);default:return e}}function o(e){return s(e)?f({},e):e}function i(e){var n="";return n+=e.multiline?"m":"",n+=e.global?"g":"",n+=e.ignorecase?"i":"",new RegExp(e.source,n)}function u(e){return new Date(+e)}function a(e){return e.slice()}var c=e("./kindOf"),s=e("./isPlainObject"),f=e("../object/mixIn");n.exports=r},{"../object/mixIn":18,"./isPlainObject":11,"./kindOf":12}],7:[function(e,n,t){function r(e,n){switch(c(e)){case"Object":return o(e,n);case"Array":return i(e,n);default:return u(e)}}function o(e,n){if(s(e)){var t={};return a(e,function(e,t){this[t]=r(e,n)},t),t}return n?n(e):e}function i(e,n){for(var t=[],o=-1,i=e.length,u;++o<i;)t[o]=r(e[o],n);return t}var u=e("./clone"),a=e("../object/forOwn"),c=e("./kindOf"),s=e("./isPlainObject");n.exports=r},{"../object/forOwn":15,"./clone":6,"./isPlainObject":11,"./kindOf":12}],8:[function(e,n,t){var r=e("./isKind"),o=Array.isArray||function(e){return r(e,"Array")};n.exports=o},{"./isKind":9}],9:[function(e,n,t){function r(e,n){return o(e)===n}var o=e("./kindOf");n.exports=r},{"./kindOf":12}],10:[function(e,n,t){function r(e){return o(e,"Object")}var o=e("./isKind");n.exports=r},{"./isKind":9}],11:[function(e,n,t){function r(e){return!!e&&"object"==typeof e&&e.constructor===Object}n.exports=r},{}],12:[function(e,n,t){function r(e){return null===e?"Null":e===u?"Undefined":o.exec(i.call(e))[1]}var o=/^\[object (.*)\]$/,i=Object.prototype.toString,u;n.exports=r},{}],13:[function(e,n,t){function r(e,n){for(var t=-1,r=e.length;++t<r;)if(u(e[t],n))return!0;return!1}function o(e,n){for(var t=-1,o=n.length;++t<o;)if(!r(e,n[t]))return!1;return!0}function i(e,n){var t=!0;return a(n,function(n,r){return u(e[r],n)?void 0:t=!1}),t}function u(e,n){return e&&"object"==typeof e?c(e)&&c(n)?o(e,n):i(e,n):e===n}var a=e("./forOwn"),c=e("../lang/isArray");n.exports=u},{"../lang/isArray":8,"./forOwn":15}],14:[function(e,n,t){function r(){a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=!0;for(var e in{toString:null})u=!1}function o(e,n,t){var o,c=0;null==u&&r();for(o in e)if(i(n,e,o,t)===!1)break;if(u)for(;(o=a[c++])&&(e[o]===Object.prototype[o]||i(n,e,o,t)!==!1););}function i(e,n,t,r){return e.call(r,n[t],t,n)}var u,a;n.exports=o},{}],15:[function(e,n,t){function r(e,n,t){i(e,function(r,i){return o(e,i)?n.call(t,e[i],i,e):void 0})}var o=e("./hasOwn"),i=e("./forIn");n.exports=r},{"./forIn":14,"./hasOwn":16}],16:[function(e,n,t){function r(e,n){return Object.prototype.hasOwnProperty.call(e,n)}n.exports=r},{}],17:[function(e,n,t){function r(){var e=1,n,t,a,c;for(c=i(arguments[0]);a=arguments[e++];)for(n in a)o(a,n)&&(t=a[n],c[n]=u(t)&&u(c[n])?r(c[n],t):i(t));return c}var o=e("./hasOwn"),i=e("../lang/deepClone"),u=e("../lang/isObject");n.exports=r},{"../lang/deepClone":7,"../lang/isObject":10,"./hasOwn":16}],18:[function(e,n,t){function r(e,n){for(var t=0,r=arguments.length,u;++t<r;)u=arguments[t],null!=u&&i(u,o,e);return e}function o(e,n){this[n]=e}var i=e("./forOwn");n.exports=r},{"./forOwn":15}],19:[function(e,n,t){"use strict";var r=e("mout/array/forEach"),o=e("mout/object/mixIn"),i=e("mout/object/merge"),u=e("mout/array/map"),a=e("mout/object/forOwn"),c=e("./mixinchain.js"),s=[].slice,f=function(e){function n(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return n.prototype=e,new n};Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var l=function y(e){var n=[],t=[].slice.call(arguments);return"function"==typeof e?n=u(t,function(e){return"function"==typeof e?e:void 0}):"object"==typeof e?r(t,function(e){a(e,function(e){n.push(e)})}):Array.isArray(e)&&r(e,function(e){n.push(e)}),n},p=function m(e,n,t){var u={methods:e||{},state:n,enclose:l(t)},a=function p(e){var n=i({},u.state),t=o(f(u.methods||{}),n,e),a=u.enclose,c=s.call(arguments,1);return r(a,function(e){"function"==typeof e&&(t=e.apply(t,c)||t)}),t};return o(a,{create:a,fixed:u,methods:function d(){var e=u.methods||{},n=[e].concat([].slice.call(arguments));return u.methods=c.apply(this,n),this},state:function h(){var e=u.state||{},n=[e].concat([].slice.call(arguments));return u.state=o.apply(this,n),this},enclose:function y(){return u.enclose=u.enclose.concat(l.apply(null,arguments)),this}})},d=function v(){var e=[].slice.call(arguments),n=p();return r(e,function(e){e&&(e.fixed.methods&&(n.fixed.methods=c({},n.fixed.methods,e.fixed.methods)),e.fixed.state&&(n.fixed.state=o({},n.fixed.state,e.fixed.state)),e.fixed.enclose&&(n.fixed.enclose=n.fixed.enclose.concat(e.fixed.enclose)))}),p(n.fixed.methods,n.fixed.state,n.fixed.enclose)},h=function O(e){return p().methods(e.prototype).enclose(e)};n.exports=o(p,{compose:d,extend:o,mixIn:o,convertConstructor:h})},{"./mixinchain.js":1,"mout/array/forEach":2,"mout/array/map":3,"mout/object/forOwn":15,"mout/object/merge":17,"mout/object/mixIn":18}]},{},[19])(19)}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return q.apply(e,arguments)}}function n(e){return e===Object(e)}function t(e){return"[object StopIteration]"===nn(e)||e instanceof tn}function r(e,n){if(F&&n.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(rn)){for(var t=[],r=n;r;r=r.source)r.stack&&t.unshift(r.stack);t.unshift(e.stack);var i=t.join("\n"+rn+"\n");e.stack=o(i)}}function o(e){for(var n=e.split("\n"),t=[],r=0;r<n.length;++r){var o=n[r];a(o)||i(o)||!o||t.push(o)}return t.join("\n")}function i(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function u(e){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(n)return[n[1],Number(n[2])];var t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function a(e){var n=u(e);if(!n)return!1;var t=n[0],r=n[1];return t===Q&&r>=T&&cn>=r}function c(){if(F)try{throw new Error}catch(e){var n=e.stack.split("\n"),t=n[0].indexOf("@")>0?n[1]:n[2],r=u(t);if(!r)return;return Q=r[0],r[1]}}function s(e,n,t){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(n+" is deprecated, use "+t+" instead.",new Error("").stack),e.apply(e,arguments)}}function f(e){return v(e)?e:O(e)?w(e):L(e)}function l(){function e(e){r=e,i.source=e,J(n,function(n,t){M(function(){e.promiseDispatch.apply(e,t)})},void 0),n=void 0,t=void 0}var n=[],t=[],r,o=X(l.prototype),i=X(h.prototype);if(i.promiseDispatch=function(e,o,i){var u=Y(arguments);n?(n.push(u),"when"===o&&i[1]&&t.push(i[1])):M(function(){r.promiseDispatch.apply(r,u)})},i.valueOf=function(){if(n)return i;var e=m(r);return v(e)&&(r=e),e},i.inspect=function(){return r?r.inspect():{state:"pending"}},f.longStackSupport&&F)try{throw new Error}catch(u){i.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(n){r||e(f(n))},o.fulfill=function(n){r||e(L(n))},o.reject=function(n){r||e(x(n))},o.notify=function(e){r||J(t,function(n,t){M(function(){t(e)})},void 0)},o}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var n=l();try{e(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}return n.promise}function d(e){return p(function(n,t){for(var r=0,o=e.length;o>r;r++)f(e[r]).then(n,t)})}function h(e,n,t){void 0===n&&(n=function(e){return x(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var r=X(h.prototype);if(r.promiseDispatch=function(t,o,i){var u;try{u=e[o]?e[o].apply(r,i):n.call(r,o,i)}catch(a){u=x(a)}t&&t(u)},r.inspect=t,t){var o=t();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function y(e,n,t,r){return f(e).then(n,t,r)}function m(e){if(v(e)){var n=e.inspect();if("fulfilled"===n.state)return n.value}return e}function v(e){return n(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function O(e){return n(e)&&"function"==typeof e.then}function g(e){return v(e)&&"pending"===e.inspect().state}function b(e){return!v(e)||"fulfilled"===e.inspect().state}function j(e){return v(e)&&"rejected"===e.inspect().state}function k(){on.length=0,un.length=0,an||(an=!0)}function G(e,n){an&&(un.push(e),on.push(n&&"undefined"!=typeof n.stack?n.stack:"(no stack) "+n))}function R(e){if(an){var n=H(un,e);-1!==n&&(un.splice(n,1),on.splice(n,1))}}function x(e){var n=h({when:function(n){return n&&R(this),n?n(e):this}},function t(){return this},function r(){return{state:"rejected",reason:e}});return G(n,e),n}function L(e){return h({when:function(){return e},get:function(n){return e[n]},set:function(n,t){e[n]=t},"delete":function(n){delete e[n]},post:function(n,t){return null===n||void 0===n?e.apply(void 0,t):e[n].apply(e,t)},apply:function(n,t){return e.apply(n,t)},keys:function(){return en(e)}},void 0,function n(){return{state:"fulfilled",value:e}})}function w(e){var n=l();return M(function(){try{e.then(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}}),n.promise}function _(e){return h({isDef:function(){}},function n(t,r){return S(e,t,r)},function(){return f(e).inspect()})}function K(e,n,t){return f(e).spread(n,t)}function E(e){return function(){function n(e,n){var u;if("undefined"==typeof StopIteration){try{u=r[e](n)}catch(a){return x(a)}return u.done?u.value:y(u.value,o,i)}try{u=r[e](n)}catch(a){return t(a)?a.value:x(a)}return y(u,o,i)}var r=e.apply(this,arguments),o=n.bind(n,"next"),i=n.bind(n,"throw");return o()}}function P(e){f.done(f.async(e)())}function N(e){throw new tn(e)}function V(e){return function(){return K([this,C(arguments)],function(n,t){return e.apply(n,t)})}}function S(e,n,t){return f(e).dispatch(n,t)}function C(e){return y(e,function(e){var n=0,t=l();return J(e,function(r,o,i){var u;v(o)&&"fulfilled"===(u=o.inspect()).state?e[i]=u.value:(++n,y(o,function(r){e[i]=r,0===--n&&t.resolve(e)},t.reject,function(e){t.notify({index:i,value:e})}))},void 0),0===n&&t.resolve(e),t.promise})}function I(e){return y(e,function(e){return e=W(e,f),y(C(W(e,function(e){return y(e,z,z)})),function(){return e})})}function D(e){return f(e).allSettled()}function U(e,n){return f(e).then(void 0,void 0,n)}function A(e,n){return f(e).nodeify(n)}var F=!1;try{throw new Error}catch(B){F=!!B.stack}var T=c(),Q,z=function(){},M=function(){function e(){for(;n.next;){n=n.next;var t=n.task;n.task=void 0;var o=n.domain;o&&(n.domain=void 0,o.enter());try{t()}catch(u){if(i)throw o&&o.exit(),setTimeout(e,0),o&&o.enter(),u;setTimeout(function(){throw u},0)}o&&o.exit()}r=!1}var n={task:void 0,next:null},t=n,r=!1,o=void 0,i=!1;if(M=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},r||(r=!0,o())},"undefined"!=typeof process&&process.nextTick)i=!0,o=function(){process.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=function(){o=a,u.port1.onmessage=e,e()};var a=function(){u.port2.postMessage(0)};o=function(){setTimeout(e,0),a()}}else o=function(){setTimeout(e,0)};return M}(),q=Function.call,Y=e(Array.prototype.slice),J=e(Array.prototype.reduce||function(e,n){var t=0,r=this.length;if(1===arguments.length)for(;;){if(t in this){n=this[t++];break}if(++t>=r)throw new TypeError}for(;r>t;t++)t in this&&(n=e(n,this[t],t));return n}),H=e(Array.prototype.indexOf||function(e){for(var n=0;n<this.length;n++)if(this[n]===e)return n;return-1}),W=e(Array.prototype.map||function(e,n){var t=this,r=[];return J(t,function(o,i,u){r.push(e.call(n,i,u,t))},void 0),r}),X=Object.create||function(e){function n(){}return n.prototype=e,new n},Z=e(Object.prototype.hasOwnProperty),en=Object.keys||function(e){var n=[];for(var t in e)Z(e,t)&&n.push(t);return n},nn=e(Object.prototype.toString),tn;tn="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var rn="From previous event:";f.resolve=f,f.nextTick=M,f.longStackSupport=!1,f.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(n,t){n?e.reject(n):e.resolve(arguments.length>2?Y(arguments,1):t)}},f.Promise=p,f.promise=p,p.race=d,p.all=C,p.reject=x,p.resolve=f,f.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},f.join=function(e,n){return f(e).join(n)},h.prototype.join=function(e){return f([this,e]).spread(function(e,n){if(e===n)return e;throw new Error("Can't join: not the same: "+e+" "+n)})},f.race=d,h.prototype.race=function(){return this.then(f.race)},f.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,n,t){function o(n){try{return"function"==typeof e?e(n):n}catch(t){return x(t)}}function i(e){if("function"==typeof n){r(e,a);try{return n(e)}catch(t){return x(t)}}return x(e)}function u(e){return"function"==typeof t?t(e):e}var a=this,c=l(),s=!1;return M(function(){a.promiseDispatch(function(e){s||(s=!0,c.resolve(o(e)))},"when",[function(e){s||(s=!0,c.resolve(i(e)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(e){var n,t=!1;try{n=u(e)}catch(r){if(t=!0,!f.onerror)throw r;f.onerror(r)}t||c.notify(n)}]),c.promise},f.when=y,h.prototype.thenResolve=function(e){return this.then(function(){return e})},f.thenResolve=function(e,n){return f(e).thenResolve(n)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},f.thenReject=function(e,n){return f(e).thenReject(n)},f.nearer=m,f.isPromise=v,f.isPromiseAlike=O,f.isPending=g,h.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=b,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=j,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var on=[],un=[],an=!0;f.resetUnhandledRejections=k,f.getUnhandledReasons=function(){return on.slice()},f.stopUnhandledRejectionTracking=function(){k(),an=!1},k(),f.reject=x,f.fulfill=L,f.master=_,f.spread=K,h.prototype.spread=function(e,n){return this.all().then(function(n){return e.apply(void 0,n)},n)},f.async=E,f.spawn=P,f["return"]=N,f.promised=V,f.dispatch=S,h.prototype.dispatch=function(e,n){var t=this,r=l();return M(function(){t.promiseDispatch(r.resolve,e,n)}),r.promise},f.get=function(e,n){return f(e).dispatch("get",[n])},h.prototype.get=function(e){return this.dispatch("get",[e])},f.set=function(e,n,t){return f(e).dispatch("set",[n,t])},h.prototype.set=function(e,n){return this.dispatch("set",[e,n])},f.del=f["delete"]=function(e,n){return f(e).dispatch("delete",[n])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},f.mapply=f.post=function(e,n,t){return f(e).dispatch("post",[n,t])},h.prototype.mapply=h.prototype.post=function(e,n){return this.dispatch("post",[e,n])},f.send=f.mcall=f.invoke=function(e,n){return f(e).dispatch("post",[n,Y(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,Y(arguments,1)])},f.fapply=function(e,n){return f(e).dispatch("apply",[void 0,n])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},f["try"]=f.fcall=function(e){return f(e).dispatch("apply",[void 0,Y(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},f.fbind=function(e){var n=f(e),t=Y(arguments,1);return function r(){return n.dispatch("apply",[this,t.concat(Y(arguments))])}},h.prototype.fbind=function(){var e=this,n=Y(arguments);return function t(){return e.dispatch("apply",[this,n.concat(Y(arguments))])}},f.keys=function(e){return f(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},f.all=C,h.prototype.all=function(){return C(this)},f.allResolved=s(I,"allResolved","allSettled"),h.prototype.allResolved=function(){return I(this)},f.allSettled=D,h.prototype.allSettled=function(){return this.then(function(e){return C(W(e,function(e){function n(){return e.inspect()}return e=f(e),e.then(n,n)}))})},f.fail=f["catch"]=function(e,n){return f(e).then(void 0,n)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},f.progress=U,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},f.fin=f["finally"]=function(e,n){return f(e)["finally"](n)},h.prototype.fin=h.prototype["finally"]=function(e){return e=f(e),this.then(function(n){return e.fcall().then(function(){return n})},function(n){return e.fcall().then(function(){throw n})})},f.done=function(e,n,t,r){return f(e).done(n,t,r)},h.prototype.done=function(e,n,t){var o=function(e){M(function(){if(r(e,i),!f.onerror)throw e;f.onerror(e)})},i=e||n||t?this.then(e,n,t):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},f.timeout=function(e,n,t){return f(e).timeout(n,t)},h.prototype.timeout=function(e,n){var t=l(),r=setTimeout(function(){t.reject(new Error(n||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),t.resolve(e)},function(e){clearTimeout(r),t.reject(e)},t.notify),t.promise},f.delay=function(e,n){return void 0===n&&(n=e,e=void 0),f(e).delay(n)},h.prototype.delay=function(e){return this.then(function(n){var t=l();return setTimeout(function(){t.resolve(n)},e),t.promise})},f.nfapply=function(e,n){return f(e).nfapply(n)},h.prototype.nfapply=function(e){var n=l(),t=Y(e);return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},f.nfcall=function(e){var n=Y(arguments,1);return f(e).nfapply(n)},h.prototype.nfcall=function(){var e=Y(arguments),n=l();return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},f.nfbind=f.denodeify=function(e){var n=Y(arguments,1);return function(){var t=n.concat(Y(arguments)),r=l();return t.push(r.makeNodeResolver()),f(e).fapply(t).fail(r.reject),r.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=Y(arguments);return e.unshift(this),f.denodeify.apply(void 0,e)},f.nbind=function(e,n){var t=Y(arguments,2);return function(){function r(){return e.apply(n,arguments)}var o=t.concat(Y(arguments)),i=l();return o.push(i.makeNodeResolver()),f(r).fapply(o).fail(i.reject),i.promise}},h.prototype.nbind=function(){var e=Y(arguments,0);return e.unshift(this),f.nbind.apply(void 0,e)},f.nmapply=f.npost=function(e,n,t){return f(e).npost(n,t)},h.prototype.nmapply=h.prototype.npost=function(e,n){var t=Y(n||[]),r=l();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},f.nsend=f.nmcall=f.ninvoke=function(e,n){var t=Y(arguments,2),r=l();return t.push(r.makeNodeResolver()),f(e).dispatch("post",[n,t]).fail(r.reject),r.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var n=Y(arguments,1),t=l();return n.push(t.makeNodeResolver()),this.dispatch("post",[e,n]).fail(t.reject),t.promise},f.nodeify=A,h.prototype.nodeify=function(e){return e?void this.then(function(n){M(function(){e(null,n)})},function(n){M(function(){e(n)})}):this};var cn=c();return f}),window.goinstant2={},window.goinstant2.BaseClasses={},goinstant2.App=function e(){function e(){var e=!1;return{log:function(n,t,r){if(e){var o="";o+=hasValue(t)?t+": ":"",o+=hasValue(r)?r+"() - ":"",isObject(n)?console.log(o,n):(o+=n,console.log(o))}},info:function(n,t,r){if(e){var o="";o+=hasValue(t)?t+": ":"",o+=hasValue(r)?r+"() - ":"",isObject(n)?console.info(o,"%O",n):(o+=n,console.info(o))}},error:function(n,t,r,o){if(e){var i="";i+=hasValue(r)?r+": ":"",i+=hasValue(o)?o+"() - ":"",i+=t,console.error(i,n)}},logging:function(n){e=n}}}var n;return{getInstance:function(){return n||(n=e()),n}}}(),window.goinstant2.App=goinstant2.App.getInstance(),goinstant2.App.logging(!0),LOG=goinstant2.App.log,INFO=goinstant2.App.info,ERROR=goinstant2.App.error,LOG_GROUP=function(e){console.group(e)},LOG_GROUP_END=function(){console.groupEnd()},goinstant2.Connection=function(e){return(new goinstant2.BaseClasses.connection).url(e)},goinstant2.connect=function(e,n,t){return new goinstant2.Connection(e).connect(n,t)},goinstant2.BaseClasses.connection=stampit().enclose(function(){function e(){var e=o.slice(15).split("/");c.keys={publish_key:e[0],subscribe_key:e[1],secret_key:e[2],origin:"pubsub-beta.pubnub.com"},r=PUBNUB.init(c.keys),c.pubnub=r}var n=null,t=!1,r=null,o,i,u,a,c={connection:this,user:null,rooms:[],pubnub:null,keys:{}};return stampit.mixIn(this,{url:function(n){return n?(o=n,e(),this):o},context:function(){return c},connect:function(e,t){var o=!1,i=!1,u=!1,a,s,f=[];hasValue(e)&&hasValue(t)?(o=!0,i=!0,a=e,s=t):isObject(e)?(o=!0,a=e,u=!0):isFunction(e)?(i=!0,s=e):u=!0,o&&(LOG(a,"Connection","connect - hasOptions"),n=_.has(a,"user")&&hasValue(a.user)?a.user:null,_.has(a,"room")?f.push(a.room):_.has(a,"rooms")&&_.forEach(a.rooms,function(e){f.push(e)}),_.has(a,"visible")&&a.visible&&console.warn("#goinstant2.connect option 'visible: false' not available in this SDK")),hasValue(n)||(n={},hasValue(n.displayName)||(n.displayName="Guest "+Math.floor(1e5*Math.random()+1e4).toString()),hasValue(n.id)||(n.id=r.uuid())),c.user=n,this.user(),0==f.length&&f.push("lobby");var l=_.map(f,function(e){var t=new goinstant2.BaseClasses.room;return t.context(c).name(e),hasValue(n)&&t.setUser(n),t.join().then(function(e){c.rooms.push(t)})});if(u){LOG("promise created","Connection","connect");var p=Q.defer(),d={connection:this,rooms:[]};return Q.allSettled(l).then(function(e){INFO("check for errors on room joins","Connection","TODO - connect"),d.rooms=c.rooms,LOG("promise resolved","Connection","connect"),p.resolve(d)}),p.promise}LOG("callback pending","Connection","connect");var h=null,y=[h];return y.push(this),INFO("Connection Errors are only generated from Room objects","Connection","connect"),Q.allSettled(l).then(function(e){INFO("check for errors on room joins","Connection","TODO - connect"),_.forEach(f,function(e){y.push(e)}),LOG("callback executing","Connection","connect"),s.apply(this,y)}),this},room:function(e){LOG(e,"Connection","connect");var t=new goinstant2.BaseClasses.room;t.context(c).name(e),hasValue(n)&&t.setUser(n),t.join().then(function(e){return c.rooms.push(t),t})},rooms:function(){return c.rooms},isGuest:function(){return t},user:function(){return LOG(n,"Connection","user"),n}})}),goinstant2.BaseClasses.room=stampit().enclose(function(){function e(e){LOG(e,"Room","_presence["+i+"]"),"join"===e.action?"function"==typeof s.join&&s.join({user:e.uuid}):("leave"===e.action||"timeout"===e.action)&&"function"==typeof s.leave&&s.leave({user:e.uuid})}function n(e,n,t){}var t,r,o,i,u,a,c,s={join:null,leave:null,joinLocal:null,leaveLocal:null},f=!1;return stampit.mixIn(this,{name:function(e){return LOG(e,"Room","name"),e?(o=e,i="ROOM:::"+e,this):o},context:function(e){return LOG(e,"Room","context"),e?(t=e,r=t.pubnub,this):t},joined:function(){return f},self:function(){return LOG("","Room","self"),INFO("return data sync info (KEY) for user with userID","Room","TODO - user"),a},setUser:function(e){u=e},user:function(e){return LOG(e,"Room","user"),INFO("return data sync info (KEY) for user with userID","Room","TODO - user"),u&&hasValue(u.id)&&e===u.id?a:_key("'.users'."+_userID)},users:function(){LOG("users collection","Room","users");var e=new goinstant2.BaseClasses.key,n="'.users'";return e.room(this).context(t).syncObject(c).path(n),e.startSync().then(function(){LOG("sync ready","Room","users"),e.info()}),e},key:function(e){var n=new goinstant2.BaseClasses.key;return n.room(this).context(t).syncObject(c).path(e),LOG("get sync object "+e,"Room","key"),n.startSync().then(function(){n.info()}),n},join:function(s,l,p){LOG_GROUP("Join Room "+o),LOG("join room "+o,"Room","join"),LOG("PUBNUB subscribe to "+i,"Room","join");var d=this,h=!1,y=!1,m=!1,v=!1,O,g;hasValue(s)&&hasValue(l)&&hasValue(p)?(h=!0,y=!0,m=!0,u=s,O=l,g=p):hasValue(s)&&hasValue(l)?(h=!0,m=!0,u=s,g=l):hasValue(s)?(m=!0,g=s):v=!0,!h&&hasValue(u)?h=!0:(u={},h=!0),hasValue(u.displayName)||(u.displayName="Guest "+Math.floor(1e5*Math.random()+1e4).toString()),hasValue(u.id)||(u.id=r.uuid()),c=i,LOG("create data sync object_id + "+i+".'.users'/"+u.id,"Room","join"),a=new goinstant2.BaseClasses.key;var b="'.users'."+u.id;a.room(this).context(t).syncObject(c).path(b).initializeData({action:"merge",value:u}),a.startSync().then(function(){LOG("sync ready","Room","join"),a.info()});var j={channel:i,presence:function(n){e(n)},message:function(e,t,r){n(e,t,r)},connect:function(){LOG("PUBNUB connected to "+i,"Room","join._pubnub.subscribe.connect"),f=!0},disconnect:function(){LOG("PUBNUB disconnected "+i,"Room","join._pubnub.subscribe.disconnect"),f=!1,console.log(_state)}};if(j.state=u,v){LOG("promise created","Room","join");var k=Q.defer();return j.connect=function(){f=!0;var e={err:null,room:d,user:u};LOG("promise resolved","Room","join"),k.resolve(e)},j.error=function(e){ERROR("promise rejected","Room","join"),k.reject(new Error(e))},r.subscribe(j),LOG_GROUP_END(),k.promise}return LOG("callback pending","Room","join"),INFO("callback","Room","TODO - join"),LOG_GROUP_END(),this},leave:function(e){return LOG("PUBNUB unsubscribe to "+o,"Room","leave"),r.unsubscribe({channel:i}),isFunction(e)&&e({err:null}),this},on:function(e,n,t){LOG(e,"Room","on");var r=!1,o=!1,i=null,u=null;"undefined"!=typeof n&&"undefined"!=typeof t?(r=!0,o=!0,i=n,u=t):"object"==typeof n?(r=!0,i=n):"function"==typeof n&&(o=!0,u=n),"join"===e?s.join=u:"leave"===e&&(s.leave=u)},off:function(e,n,t){_self=this,LOG(e,"Room","off");var r=!1,o=!1,i=!1,u=null,a=null;("undefined"!=typeof e||null!=e)&&(r=!0),"undefined"!=typeof n&&"undefined"!=typeof t?(o=!0,i=!0,u=n,a=t):"object"==typeof n?(o=!0,u=n):"function"==typeof n&&(i=!0,a=n),r||o||i||(s.join=null,s.leave=null)}})}),goinstant2.Channel=function n(e,t){function r(e,n,t){isFunction(s.message)&&message(e)}function o(e,n){var t={err:null},r=function o(e){null!==e&&"undefined"!=typeof e&&(t.err=e)};u.publish({channel:a,message:e,error:r}),isFunction(n)&&n(t)}var i=e,u=i.pubnub,a=t,c={joined:!1},s={message:null};return function f(){var e={channel:a,message:function(e,n,t){r(e,n,t)},connect:function(){this._state.joined=!0},disconnect:function(){this._state.joined=!1}};"undefined"!==_user.displayName&&(e.state={id:_user.id,displayName:_user.displayName}),u.subscribe(e)}(),{message:function(e,n){o(e,n)},on:function(e,n){hasValue(e)&&"message"===e&&isFunction(n)&&(s.message=n)}}},goinstant2.BaseClasses.key=stampit().enclose(function(){var e,n,t,r,o,i,u=!1,a=!1,c=!1,s=Q.defer(),f=[],l=[],p=[];return stampit.mixIn(this,{syncObject:function(e){return e?(r=e,this):r},path:function(e,n){var t=this;return e?(o=e.replace(/\//g,"."),INFO("implement path hierarchy","Key","TODO - get"),this):o},isSynced:function(){return c},initializeData:function(e){return!u&&e?(f.push(e),this):f},startSync:function(){var t=this;return u?s.promise:(u=!0,LOG_GROUP("Key: startSync() initiated"),LOG("initiated","Key","startSync"),LOG(r,"Key","key.objectID"),LOG(o,"Key","key.path"),LOG_GROUP_END(),i=n.get_synced_object({object_id:r,path:o,connect:function(n){LOG_GROUP("Key: "+r+" - connect() complete"),LOG(r,"Key","key.object_id"),LOG(o,"Key","key.path"),LOG(i.data,"Key","key.get"),LOG_GROUP_END(),LOG_GROUP("Key: "+r+" - initializeData()"),LOG(r,"Key","key.object_id"),LOG(o,"Key","key.path"),LOG(f,"Key","startSync - initialOperations");var u=_.map(f,function(e){return"set"===e.action?t.set(e.value,{initializeOverride:!0}):"merge"===e.action?(LOG("execute merge() - promise","Room","startSync - initialOperations"),t.merge(e.value,{initializeOverride:!0})):"add"===e.action?t.add(e.value,{initializeOverride:!0}):"remove"===e.action?t.remove({initializeOverride:!0}):void 0});Q.allSettled(u).then(function(){LOG_GROUP_END(),f=[],a=!0,INFO("might need to add a deferred promise, to stop adding deferred operations"),LOG_GROUP("Key: "+r+" - deferredOperations()"),LOG(r,"Key","key.object_id"),LOG(o,"Key","key.path"),LOG(l,"Room","startSync - deferredOperations");var n=_.map(l,function(n){return"get"===n.action?n.usePromise?(LOG("execute get() - promise","Room","startSync - deferredOperations"),t.get(function(e,t,r){var o={err:e,value:t,context:r};console.log(o),n.defer.resolve(o)}),n.defer):t.get().then(function(t){var r=[null,value,e];n.callback.apply(this,r)}):"set"===n.action?(LOG("execute set()","Room","startSync - deferredOperations"),t.set(n.value).then(n.usePromise?function(e){n.defer.resolve(e)}:function(t){var r=[null,value,e];n.callback.apply(this,r)})):"add"===n.action?(LOG("execute add()","Room","startSync - deferredOperations"),t.add(n.value).then(n.usePromise?function(e){n.defer.resolve(e)}:function(t){var r=[null,value,e];n.callback.apply(this,r)})):"merge"===n.action?(LOG("execute merge()","Room","startSync - deferredOperations"),t.merge(n.value).then(n.usePromise?function(e){n.defer.resolve(e)}:function(t){var r=[null,value,e];n.callback.apply(this,r)})):"remove"===n.action?(LOG("execute remove()","Room","startSync - deferredOperations"),t.remove().then(n.usePromise?function(e){n.defer.resolve(e)}:function(t){var r=[null,value,e];n.callback.apply(this,r)})):void 0});Q.allSettled(n).then(function(){LOG_GROUP_END(),l=[],c=!0,LOG_GROUP("Key: "+r+" - startSync() promise resolved"),LOG(r,"Key","key.object_id"),LOG(o,"Key","key.path"),LOG(i.data,"Key","key.get"),LOG_GROUP_END(),s.resolve({err:null,value:i.data,context:e})})})},callback:function(e){LOG_GROUP("Key: "+r+" - get_synced_object - callback (updates)"),LOG(r,"Key","key.object_id"),LOG(o,"Key","key.path");for(var n=0;n<e.length;n++)LOG(e[n],"Key","path - get_synced_object - callback");LOG(i.data,"Key","key.get"),LOG_GROUP_END()},error:function(e){LOG("Key: "+r+"."+o+" - startSync promise rejected","Key","startSync"),ERROR(e,"get_synced_object","Key","path - get_synced_object - error"),s.reject(new Error(e))
}}),s.promise)},room:function(e){return e?(t=e,this):t},context:function(t){return t?(e=t,n=e.pubnub,this):e},key:function(n){var t=new goinstant2.BaseClasses.key;return t.room(this).context(e).roomName(_roomName).name(n).parent(this),t},parent:function(){return value?(_parent=value,this):_parent},info:function(){LOG_GROUP("Key: INFO()"),LOG(r,"Key","key.objectID"),LOG(o,"Key","key.path"),LOG(i.data,"Key","key.value"),LOG_GROUP_END()},get:function(n){var t=!1,u=!1,c;if(hasValue(n)?(t=!0,c=n):u=!0,a){var s={object_id:r,path:o};if(u){var f=Q.defer(),p={err:null,value:i.data,context:e};return f.resolve(p),f.promise}LOG("get successful - callback","Key","get");var d=[null,i.data,e];c.apply(this,d)}else{LOG(r+"."+o+" - get() deferred");var h={action:"get",hasCallback:t,usePromise:u};if(u)return h.defer=Q.defer(),l.push(h),h.defer.promise;h.callback=c,l.push(h)}return this},add:function(t,i,u){var c=!1,s=!1,f=!1,p,d;hasValue(i)&&hasValue(u)?(c=!0,s=!0,p=i,d=u):hasValue(i)?isFunction(i)?(s=!0,d=i):(c=!0,f=!0,p=i):f=!0;var h=a;if(c&&_.has(p,"initializeOverride")&&(h=!0),h){var y=o+"."+n.uuid(),m={object_id:r,path:y,data:t};if(f){var v=Q.defer();return m.callback=function(n){v.resolve({err:null,newValue:t,context:_.merge(e,{addedKey:y})}),LOG("add successful - promise","Key","add")},m.error=function(e){ERROR(e,"add error - promise","Key","add"),v.reject(new Error(e))},n.merge(m),v.promise}m.callback=function(n){LOG("add successful - callback","Key","add");var r=[null,t,_.merge(e,{addedKey:y})];d.apply(this,r)},m.error=function(n){ERROR(n,"add error - callback","Key","add");var t=[n,null,e];d.apply(this,t)}}else{LOG(r+"."+o+" - add() deferred");var O={action:"add",value:t,hasCallback:s,usePromise:f};if(f)return O.defer=Q.defer(),l.push(O),O.defer.promise;O.callback=d,l.push(O)}return this},remove:function(t,u){var c=!1,s=!1,f=!1,p,d;hasValue(t)&&hasValue(u)?(c=!0,s=!0,p=t,d=u):hasValue(t)?isFunction(t)?(s=!0,d=t):(c=!0,f=!0,p=t):f=!0;var h=a;if(c&&_.has(p,"initializeOverride")&&(h=!0),h){var y={object_id:r,path:o};if(f){var m=Q.defer(),v=i.data;return INFO("add lastValue as option(default true right now)","Key","TODO - remove"),y.callback=function(n){m.resolve({err:null,value:v,context:e}),LOG("remove successful - promise","Key","remove")},y.error=function(e){ERROR(e,"remove error - promise","Key","remove"),m.reject(new Error(e))},n.remove(y),m.promise}y.callback=function(n){LOG("remove successful - callback","Key","remove");var t=[null,value,_.merge(e,{lastValue:v})];d.apply(this,t)},y.error=function(n){ERROR(n,"remove error - callback","Key","remove");var t=[n,null,e];d.apply(this,t)}}else{LOG(r+"."+o+" - remove() deferred");var O={action:"remove",hasCallback:s,usePromise:f};if(f)return O.defer=Q.defer(),l.push(O),O.defer.promise;O.callback=d,l.push(O)}return this},set:function(t,i,u){var c=!1,s=!1,f=!1,p,d;hasValue(i)&&hasValue(u)?(c=!0,s=!0,p=i,d=u):hasValue(i)?isFunction(i)?(s=!0,d=i):(c=!0,f=!0,p=i):f=!0;var h=a;if(c&&_.has(p,"initializeOverride")&&(h=!0),h){var y=o+"."+n.uuid(),m={object_id:r,path:y,data:t};if(f){var v=Q.defer();return m.callback=function(n){v.resolve({err:null,newValue:t,context:_.merge(e,{addedKey:y})}),LOG("set successful - promise","Key","set")},m.error=function(e){ERROR(e,"set error - promise","Key","set"),v.reject(new Error(e))},n.merge(m),v.promise}m.callback=function(n){LOG("set successful - callback","Key","set");var r=[null,t,e];d.apply(this,r)},m.error=function(n){ERROR(n,"set error - callback","Key","set");var t=[n,null,e];d.apply(this,t)}}else{LOG(r+"."+o+" - set() deferred");var O={action:"set",value:t,hasCallback:s,usePromise:f};if(f)return O.defer=Q.defer(),l.push(O),O.defer.promise;O.callback=d,l.push(O)}return this},merge:function(t,u,c){var s=!1,f=!1,p=!1,d,h;hasValue(u)&&hasValue(c)?(s=!0,f=!0,d=u,h=c):hasValue(u)?isFunction(u)?(f=!0,h=u):(s=!0,p=!0,d=u):p=!0;var y=a;if(s&&_.has(d,"initializeOverride")&&(y=!0),y){var m={object_id:r,path:o,data:t};if(p){var v=Q.defer();return LOG("merge promise created","Key","merge"),m.callback=function(n){v.resolve({err:null,value:i.data,context:e}),LOG("merge successful - promise resolved","Key","merge"),LOG(t,"Key","merge"),LOG(i.data,"Key","merge")},m.error=function(e){ERROR(e,"merge error - promise","Key","merge"),v.reject(new Error(e))},n.merge(m),v.promise}m.callback=function(n){LOG("merge successful - callback","Key","merge");var t=[null,i.data,e];h.apply(this,t)},m.error=function(n){ERROR(n,"merge error - callback","Key","merge");var t=[n,null,e];h.apply(this,t)}}else{LOG(r+"."+o+" - merge() deferred");var O={action:"merge",value:t,hasCallback:f,usePromise:p};if(p)return O.defer=Q.defer(),l.push(O),O.defer.promise;O.callback=h,l.push(O)}return this},on:function(e,n,t){return this}})});
//# sourceMappingURL=./pubnub-goinstant.min.map